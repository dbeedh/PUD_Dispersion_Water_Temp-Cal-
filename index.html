<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PUD Water Mixing Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .logo {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 100px;
            height: 60px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .logo-img {
            width: 100%;
            height: 100%;
            background: #FF0000;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            letter-spacing: 2px;
            font-family: Arial, sans-serif;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .main-content {
            padding: 30px;
        }

        .warning-section {
            margin-bottom: 30px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-danger {
            background: #fee;
            border: 2px solid #dc3545;
            color: #721c24;
        }

        .alert-warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
        }

        .alert-info {
            background: #d1ecf1;
            border: 2px solid #17a2b8;
            color: #0c5460;
        }

        .calculator-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .form-group input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input.invalid {
            border-color: #dc3545;
            background-color: #fee;
        }

        .form-group input.valid {
            border-color: #28a745;
            background-color: #f0fff4;
        }

        .results-section {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            font-size: 18px;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-value {
            font-weight: bold;
            font-size: 24px;
        }

        .calculate-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: transform 0.2s;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .formula-display {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: monospace;
            text-align: center;
            font-size: 16px;
            border-left: 4px solid #667eea;
        }

        .validation-msg {
            font-size: 14px;
            margin-top: 5px;
            font-weight: 500;
        }

        .validation-msg.error {
            color: #dc3545;
        }

        .validation-msg.success {
            color: #28a745;
        }

        @media (max-width: 768px) {
            .input-group {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .container {
                margin: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
        }

        .icon {
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-img">BIP</div>
            </div>
            <h1>PUD Water Mixing Calculator</h1>
            <p>Polyurethane Dispersion Process - Water Temperature Control</p>
        </div>

        <div class="main-content">
            <!-- Critical Warnings Section -->
            <div class="warning-section">
                <div class="alert alert-danger">
                    <span class="icon">‚ö†Ô∏è</span>
                    <div>
                        <strong>CRITICAL WARNING:</strong> Dispersion water temperature may have an effect on the final particle size distribution of the finished product which could impact the viscosity!
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <span class="icon">üå°Ô∏è</span>
                    <div>
                        <strong>TEMPERATURE PROBE REMINDER:</strong> Ensure temperature probe is fully submerged and positioned in the centre of the IBC for accurate readings.
                    </div>
                </div>
                 <div class="alert alert-info">
                    <span class="icon">üå°Ô∏è</span>
                    <div>
                        <strong>TOWNS WATER TEMPERATURE CHECK:</strong> Towns water temperature can be obtained from the water deioniser in the AdBlue Plant.
                    </div>
                </div>

            </div>

            <!-- Formula Display -->
            <div class="formula-display">
                <strong>Formula:</strong> x = ((T3 √ó V3) - (T2 √ó V3)) / (T1 - T2)
                <br><small>Where x = Volume of chilled water required (litres)</small>
            </div>

            <!-- Calculator Section -->
            <div class="calculator-section">
                <h3 style="margin-bottom: 20px; color: #2c3e50;">Water Mixing Calculation</h3>
                
                <div class="input-group">
                    <div class="form-group">
                        <label for="t1">Chilled Water Temperature (T1) ¬∞C</label>
                        <input type="number" id="t1" step="0.1" min="2.5" max="5" placeholder="2.5 - 5.0">
                        <div class="validation-msg" id="t1-msg"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="t2">Towns Water Temperature (T2) ¬∞C</label>
                        <input type="number" id="t2" step="0.1" min="15" max="30" placeholder="15 - 30">
                        <div class="validation-msg" id="t2-msg"></div>
                    </div>
                </div>

                <div class="input-group">
                    <div class="form-group">
                        <label for="t3">Target Temperature (T3) ¬∞C</label>
                        <input type="number" id="t3" step="0.1" min="10" max="20" placeholder="12 - 18">
                        <div class="validation-msg" id="t3-msg"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="v3">Total Volume Required (V3) Litres</label>
                        <input type="number" id="v3" step="1" min="1000" max="3000" placeholder="1000 - 3000">
                        <div class="validation-msg" id="v3-msg"></div>
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculateMixing()">Calculate Water Volumes</button>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="results" style="display: none;">
                <h3 style="margin-bottom: 20px;">Mixing Requirements</h3>
                
                <div class="result-item">
                    <span>Chilled Water Required (V1):</span>
                    <span class="result-value" id="v1-result">-- L</span>
                </div>
                
                <div class="result-item">
                    <span>Towns Water Required (V2):</span>
                    <span class="result-value" id="v2-result">-- L</span>
                </div>
                
                <div class="result-item">
                    <span>Final Temperature Check:</span>
                    <span class="result-value" id="temp-check">-- ¬∞C</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        function validateInput(input, min, max, msgElement, label) {
            const value = parseFloat(input.value);
            
            if (input.value === '') {
                input.className = '';
                msgElement.textContent = '';
                return null;
            }
            
            if (isNaN(value)) {
                input.className = 'invalid';
                msgElement.textContent = 'Please enter a valid number';
                msgElement.className = 'validation-msg error';
                return null;
            }
            
            if (value < min || value > max) {
                input.className = 'invalid';
                msgElement.textContent = `${label} must be between ${min} and ${max}`;
                msgElement.className = 'validation-msg error';
                return null;
            }
            
            input.className = 'valid';
            msgElement.textContent = '‚úì Valid';
            msgElement.className = 'validation-msg success';
            return value;
        }

        function validateTemperatureLogic(t1, t2, t3) {
            const errors = [];
            
            if (t1 >= t2) {
                errors.push('Chilled water temperature must be lower than towns water temperature');
            }
            
            if (t3 <= t1 || t3 >= t2) {
                errors.push('Target temperature must be between cold water and towns water temperatures');
            }
            
            return errors;
        }

        function showTemperatureWarnings(t3) {
            // Clear existing dynamic warnings
            const existingDynamic = document.querySelector('.dynamic-warning');
            if (existingDynamic) {
                existingDynamic.remove();
            }
            
            if (t3 > 18) {
                const warning = document.createElement('div');
                warning.className = 'alert alert-danger dynamic-warning';
                warning.innerHTML = '<span class="icon">üö®</span><div><strong>DANGER:</strong> Target temperature above ¬∞C will cause dispersion failure!</div>';
                document.querySelector('.warning-section').appendChild(warning);
            } else if (t3 > 16) {
                const warning = document.createElement('div');
                warning.className = 'alert alert-warning dynamic-warning';
                warning.innerHTML = '<span class="icon">‚ö†Ô∏è</span><div><strong>CAUTION:</strong> Approaching maximum safe temperature. Monitor dispersion carefully.</div>';
                document.querySelector('.warning-section').appendChild(warning);
            }
        }

        function calculateMixing() {
            // Get input elements
            const t1Input = document.getElementById('t1');
            const t2Input = document.getElementById('t2');
            const t3Input = document.getElementById('t3');
            const v3Input = document.getElementById('v3');
            
            // Get message elements
            const t1Msg = document.getElementById('t1-msg');
            const t2Msg = document.getElementById('t2-msg');
            const t3Msg = document.getElementById('t3-msg');
            const v3Msg = document.getElementById('v3-msg');
            
            // Validate inputs
            const t1 = validateInput(t1Input, 2, 5, t1Msg, 'Cold water temperature');
            const t2 = validateInput(t2Input, 15, 35, t2Msg, 'Towns water temperature');
            const t3 = validateInput(t3Input, 10, 20, t3Msg, 'Target temperature');
            const v3 = validateInput(v3Input, 1000, 3000, v3Msg, 'Total volume');
            
            // Check if all inputs are valid
            if (t1 === null || t2 === null || t3 === null || v3 === null) {
                document.getElementById('results').style.display = 'none';
                return;
            }
            
            // Validate temperature logic
            const logicErrors = validateTemperatureLogic(t1, t2, t3);
            if (logicErrors.length > 0) {
                alert('Temperature Logic Error:\n' + logicErrors.join('\n'));
                document.getElementById('results').style.display = 'none';
                return;
            }
            
            // Show temperature warnings
            showTemperatureWarnings(t3);
            
            // Calculate using the formula: x = ((T3√óV3)-(T2√óV3))/(T1-T2)
            const numerator = (t3 * v3) - (t2 * v3);
            const denominator = t1 - t2;
            
            if (Math.abs(denominator) < 0.01) {
                alert('Error: Cold water and towns water temperatures are too similar for accurate mixing calculation.');
                return;
            }
            
            const v1 = numerator / denominator;
            const v2 = v3 - v1;
            
            // Validate results
            if (v1 < 0 || v2 < 0) {
                alert('Calculation Error: Cannot achieve target temperature with given parameters. Check your input values.');
                return;
            }
            
            if (v1 > v3) {
                alert('Calculation Error: Required chilled water volume exceeds total volume needed.');
                return;
            }
            
            // Verify calculation by computing final temperature
            const finalTemp = ((t1 * v1) + (t2 * v2)) / v3;
            
            // Display results
            document.getElementById('v1-result').textContent = Math.round(v1) + ' L';
            document.getElementById('v2-result').textContent = Math.round(v2) + ' L';
            document.getElementById('temp-check').textContent = finalTemp.toFixed(1) + ' ¬∞C';
            
            document.getElementById('results').style.display = 'block';
            
            // Scroll to results
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        // Real-time validation
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = ['t1', 't2', 't3', 'v3'];
            const ranges = {
                't1': {min: 2, max: 5, label: 'Cold water temperature'},
                't2': {min: 15, max: 35, label: 'Towns water temperature'},
                't3': {min: 10, max: 20, label: 'Target temperature'},
                't3': {min: 1000, max: 3000, label: 'Total volume'}
            };
            
            inputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                const msgElement = document.getElementById(inputId + '-msg');
                
                input.addEventListener('input', function() {
                    if (inputId === 't1') {
                        validateInput(input, 2.5, 5, msgElement, 'Chilled water temperature');
                    } else if (inputId === 't2') {
                        validateInput(input, 15, 30, msgElement, 'Towns water temperature');
                    } else if (inputId === 't3') {
                        validateInput(input, 10, 20, msgElement, 'Target temperature');
                    } else if (inputId === 'v3') {
                        validateInput(input, 1000, 3000, msgElement, 'Total volume');
                    }
                });
                
                // Auto-calculate when all fields are filled
                input.addEventListener('input', function() {
                    setTimeout(() => {
                        const allFilled = inputs.every(id => document.getElementById(id).value !== '');
                        const allValid = inputs.every(id => document.getElementById(id).className === 'valid');
                        
                        if (allFilled && allValid) {
                            calculateMixing();
                        }
                    }, 100);
                });
            });
        });
    </script>
</body>
</html>
